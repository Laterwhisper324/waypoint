<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WayPoint - Cadastro</title>
    <link rel="stylesheet" href="cadastro_style.css">
</head>
<body>
    <div class="cadastro-container">
        <header class="topbar">
            <img src="imagens/logo_waypoint.png" alt="WayPoint Logo" id="lg_top">
            <div id="links-container">
                <a href="index.html" class="links">Início</a>
                <a href="#" class="links">Passagens</a>
                <a href="#" class="links">Descobrir</a>
                <a href="#" class="links">Contato</a>
            </div>
        </header>
        <main class="cadastro-main">
            <form class="cadastro-box" autocomplete="off" method="POST" action="http://localhost:3000/cadastro">
                <div class="cadastro-title">Crie sua conta</div>
                <label class="cadastro-label" for="cadastro-nome">Nome completo</label>
                <input class="cadastro-input" type="text" id="cadastro-nome" name="nome" placeholder="Seu nome" required>
                <label class="cadastro-label" for="cadastro-email">E-mail</label>
                <input class="cadastro-input" type="email" id="cadastro-email" name="email" placeholder="seu@email.com" required>
                <label class="cadastro-label" for="cadastro-senha">Senha</label>
                <input class="cadastro-input" type="password" id="cadastro-senha" name="senha" placeholder="Crie uma senha" required>
                <label class="cadastro-label" for="cadastro-confirmar">Confirmar senha</label>
                <input class="cadastro-input" type="password" id="cadastro-confirmar" name="confirmar" placeholder="Repita a senha" required>
                <button class="cadastro-btn" type="submit">Cadastrar</button>
                <div class="cadastro-footer">
                    Já tem conta? <a href="../login.html">Entrar</a>
                </div>
            </form>
        </main>
        <footer class="footer">
            &copy; 2025 WayPoint. Todos os direitos reservados.
        </footer>
    </div>
    <script>
        // Cadastro sem restrições
        app.post('/cadastro', (req, res) => {
            const { nome, email, senha } = req.body;
            const linha = `Nome: ${nome} | Email: ${email} | Senha: ${senha}\n`;
            const filePath = path.join(__dirname, 'cadastros-feitos');

            fs.appendFile(filePath, linha, (err) => {
                if (err) {
                    return res.status(500).send('Erro ao salvar cadastro.');
                }
                res.send('<h2>Cadastro realizado com sucesso!</h2><a href="cadastro.html">Voltar</a>');
            });
        });

        // Login sem restrições (apenas verifica se existe a combinação)
        app.post('/login', (req, res) => {
            const { email, senha } = req.body;
            const filePath = path.join(__dirname, 'cadastros-feitos');

            fs.readFile(filePath, 'utf8', (err, data) => {
                if (err || !data) {
                    return res.status(500).send('Erro ao acessar cadastros.');
                }
                const linhas = data.split('\n');
                for (const linha of linhas) {
                    if (linha.includes(`Email: ${email}`) && linha.includes(`Senha: ${senha}`)) {
                        // Extrai o nome do usuário
                        const nomeMatch = linha.match(/Nome:\s*([^|]+)/);
                        const nome = nomeMatch ? nomeMatch[1].trim() : 'Usuário';
                        return res.send({ sucesso: true, nome });
                    }
                }
                res.send({ sucesso: false, mensagem: 'E-mail ou senha incorretos.' });
            });
        });

        window.location.href = "index.html";
    </script>
    <script href="server.js"></script>
</body>
</html>